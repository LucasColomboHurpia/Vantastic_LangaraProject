//0    //1     //2           //3     //4    //5     //6       //7      //8       //9       //10       //11        //12     //13          //14                   //15
const surveyTags = ['Day','Night','Adrenaline','Relax','Beach','Lake','Outdoor','Indoor','History','Culture','Big City','Small City','Group','Individual', 'City Landscapes', 'Nature Landscapes']


challengesExample = [
    {
        id: '254yh24wtuh62utru2y24554y',
        name: 'THE HANGING BRIDGE CHALLENGE',
        description: 'Lorem, ipsum dolor sit amet consectetur adipisicing elit. Adipisci itaque soluta ea!',
        steps: {
            low: [
                {
                    desc: "Go to Lynn Valley Park in North Vancouver. When you’re there, take a picture with the welcome sign! Don’t forget that it might be dangerous being in the forest at night, so we recommend not going too late!",
                    coord: { lat: 49.34292296418448, lng: -123.01977724677438 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "Hope you’re not afraid of heights! Take a picture standing on the hanging bridge, and don’t forget to take the time to enjoy the view! ",
                    coord: { lat: 49.34393808747806, lng: -123.0180606869341 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "Delight yourself with this park’s captivating views by walking down the park. Find the waterfall and take a picture with it! ",
                    coord: { lat: 49.34393808747806, lng: -123.0180606869341 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
            ],
            high: [
                {
                    desc: "Go to Capilano in North Vancouver. When you’re there, take a picture with the welcome sign! Don’t forget that it might be dangerous being in the forest at night, so we recommend not going too late! ",
                    coord: { lat: 49.3426884715942, lng: -123.11402141238946 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "	Hope you’re not afraid of heights! Take a picture standing on the hanging bridge, and don’t forget to take the time to enjoy the view! ",
                    coord: { lat: 49.34287347137181, lng: -123.11492004060521 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "Delight yourself by having lunch -or a drink- in The Cliff House Restaurant and Bar while enjoying the captivating views. Share us a picture of what you decide to order! ",
                    coord: { lat: -123.11492004060521, lng: -123.11380161190166 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
            ],
        },
        image: '../Assets/default_img.jpg',
        budget: '',
        placeId: '',
        areaCoordinates: { lat: 49.34470485653275, lng: -123.02505444279568 },
        premium: true,
        surveyScore: 0,
        tags: [surveyTags[15], surveyTags[0], surveyTags[2], surveyTags[5], surveyTags[6], surveyTags[9], surveyTags[13], surveyTags[11]]
    },

    {
        id: '9p8u07gty8bgvf7t9vcfg',
        name: 'THE SEAWALL CHALLENGE',
        description: 'Lorem, ipsum dolor sit amet consectetur adipisicing elit. Adipisci itaque soluta ea!',
        steps: {
            low: [
                {
                    desc: "Go to Sunset Beach and find the Inukshuk Stone Sculpture. Take a picture with it and share it with us! You will most likely see people playing games. Join them if you feel like it!",
                    coord: { lat: 49.284468944204576, lng: -123.14374494434401 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "Vancouver has the world’s longest uninterrupted waterfront path. Now that you are in Sunset Beach you can enjoy it by walking a segment of it. Head to the north along the seawall until you reach English Bay, and don’t forget to take a picture of the views! ",
                    coord: { lat: 49.28978713432972, lng: -123.14486192683597 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "The A-maze-ing Laughter bronze sculpture is there to bring a smile to the ones that see it. Share with us a picture of you smiling with the statues! ",
                    coord: { lat: 49.2877459713639, lng: -123.14186677222345 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
            ],
            high: [ 
                {
                    desc: "Go to Sunset Beach and find the Inukshuk Stone Sculpture. Take a picture with it and share it with us! You will most likely see people playing games. Join them if you feel like it!",
                    coord: { lat: 49.28430649257112, lng: -123.14375633650968 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "	Vancouver has the world’s longest uninterrupted waterfront path. Now that you are in Sunset Beach you can enjoy it by walking a segment of it. Head to the north along the seawall until you reach English Bay, and don’t forget to take a picture of the views!",
                    coord: false,
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                { 
                    desc: "The A-maze-ing Laughter bronze sculpture is there to bring a smile to the ones that see it. Share with us a picture of you smiling with the statues!",
                    coord: { lat: 49.287596913119486, lng: -123.14192174110453 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
            ],
        },
        image: '../Assets/default_img.jpg',
        budget: '',
        placeId: '',
        areaCoordinates: { lat: 49.286614016719064, lng: -123.1424614420471 },
        premium: true,
        surveyScore: 0,
        tags: [surveyTags[14], surveyTags[0], surveyTags[1], surveyTags[3], surveyTags[4], surveyTags[6], surveyTags[8], surveyTags[10], surveyTags[12],]
    },

    {
        id: '21u7g4812knrsara',
        name: 'THE GRANVILLE ISLAND CHALLENGE',
        description: 'Lorem, ipsum dolor sit amet consectetur adipisicing elit. Adipisci itaque soluta ea!',
        steps: {
            low: [
                {
                    desc: "Take a picture with the Granville welcome sign. ",
                    coord: { lat: 49.271462098991094, lng: -123.13392546147028 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "Have lunch at the Granville market. Take a picture of your plate! ",
                    coord: { lat: 49.272862382088384, lng: -123.13515022900297 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "Try the famous Lee Donuts. Share with us a pic of the doughnut you picked!  ",
                    coord: { lat: 49.27239008303922, lng: -123.13525514434446 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
            ],
            high: [ 
                {
                    desc: "Take a picture with the Granville welcome sign.",
                    coord: { lat: 49.27012311030005, lng: -123.1367827938784 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "	Have lunch at the Sandbar. Take a picture of your plate!",
                    coord: false,
                    tag: ['restaurant','bar','cafe'],
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                { 
                    desc: "Try the famous Lee Donuts. Share with us a pic of the doughnut you picked!",
                    coord: { lat: 49.272265103234105, lng: -123.13527755710894 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
            ],
        },
        image: '../Assets/default_img.jpg',
        budget: '',
        placeId: '',
        areaCoordinates: { lat: 49.27048109309838, lng: -123.13479550485158},
        premium: true,
        surveyScore: 0,
        tags: [surveyTags[14], surveyTags[0], surveyTags[1], surveyTags[3], surveyTags[7], surveyTags[9], surveyTags[11], surveyTags[13]]
    },

    {
        id: 'dfsava8747543g',
        name: 'THE DOWNTOWN CHALLENGE', //
        description: 'Lorem, ipsum dolor sit amet consectetur adipisicing elit. Adipisci itaque soluta ea!',
        steps: {
            low: [
                {
                    desc: "Walk around Canada Place. Share with us a picture of when you reach the end!",
                    coord: { lat: 49.28895767206503, lng: -123.11104581435612 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "Take a look at downtown from the Harbour Centre. Don’t forget to take a picture of the beautiful beach! ",
                    coord: { lat: 49.28482228933386, lng: -123.1118699039284 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "Have lunch in Gastown. Share with us a picture of what you decided to order!",
                    coord: { lat: 49.284576542322675, lng: -123.10887160201466 },
                    tag: ['restaurant','bar','cafe'],
                    image: '../Assets/default_img.jpg',
                    done: false
                },
            ],
            high: [
                {
                    desc: "Walk around Canada Place. Share with us a picture of when you reach the end!",
                    coord: false,
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "Take a look at downtown from the Harbour Centre. Don’t forget to take a picture of the beautiful beach!",
                    coord: false,
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "Have lunch in Gastown. Share with us a picture of what you decided to order!",
                    coord: false,
                    tag: ['restaurant','bar','cafe'],
                    image: '../Assets/default_img.jpg',
                    done: false
                },
            ],
        },
        image: '../Assets/default_img.jpg',
        budget: '',
        placeId: '', 
        areaCoordinates: { lat: 49.288334842288705, lng: -123.1124199551516 },
        premium: true,
        surveyScore: 0,
        tags: [surveyTags[14], surveyTags[0], surveyTags[1], surveyTags[2], surveyTags[6], surveyTags[10], surveyTags[13]]
    },

    {
        id: 'bnm4b198mb9nm42',
        name: 'THE WHISTLER CHALLENGE',
        description: 'Lorem, ipsum dolor sit amet consectetur adipisicing elit. Adipisci itaque soluta ea!',
        steps: {
            low: [
                {
                    desc: "Enjoy a coffee, a hot chocolate, or one of the amazing snacks at Purebread bakery. Show us a picture of your selection!",
                    coord: { lat: 50.120135833471615, lng: -122.95571203748781 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "Amuse yourself with Olympic Village’s beautiful architecture. Share with us a pic of your favourite building!",
                    coord: { lat: 50.081325255158916, lng: -123.04097745907954 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "Activity 3",
                    coord: false,
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
            ],
            high: [
                {
                    desc: "Enjoy a coffee, a hot chocolate, or one of the amazing snacks at Purebread bakery. Show us a picture of your selection!",
                    coord: { lat: 50.120135833471615, lng: -122.95571203748781 },
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "Go to the top of the mountain and share with us a picture of the amazing views!",
                    coord: false,
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
                {
                    desc: "Activity 3",
                    coord: false,
                    tag: false,
                    image: '../Assets/default_img.jpg',
                    done: false
                },
            ],
        },
        image: '../Assets/default_img.jpg',
        budget: '',
        placeId: '', 
        areaCoordinates: { lat: 50.12040687042842, lng: -122.95420441063983 },
        premium: true,
        surveyScore: 0,
        tags: [/* surveyTags[15], surveyTags[0], surveyTags[2], surveyTags[6], surveyTags[8], surveyTags[12], surveyTags[3]*/]
    }, 

]

const challengesFinalValues = ''
const placesFinalValues = ''

const markerN1 = "../Assets/number 1 - marker.png";
const markerN2 = "../Assets/number 2 - marker.png";
const markerN3 = "../Assets/number 3 - marker.png";

const orangeMarkerN1 = "../Assets/number 1 - orange marker.png";
const orangeMarkerN2 = "../Assets/number 2 - orange marker.png";
const orangeMarkerN3 = "../Assets/number 3 - orange marker.png";


let userResults = JSON.parse(localStorage.getItem('user'))
let userPreferences = userResults.preferences
let surveyResults = userResults.preferences.surveyResults


const preferences = (surveyResults) => {
    //gets first favorite, then scond and third
    //gets places favorites
    let highestValChallenges = { value: 0 }
    let secondHighestValChallenges = { value: 0 }
    let thirdHighestValChallenges = { value: 0 }

    for (item of surveyResults.placesPreferences) {

        //finds the biggest number
        if (item.value > highestValChallenges.value) {
            highestValChallenges = item
        }
        //finds the second biggest number
        if (item.value > secondHighestValChallenges.value && item.name != highestValChallenges.name) {
            secondHighestValChallenges = item
        }

        //finds the third biggest number
        if (item.value > thirdHighestValChallenges.value && item.name != highestValChallenges.name && item.name != secondHighestValChallenges.name) {
            thirdHighestValChallenges = item
        }
    }
    let bestPlaces = [highestValChallenges, secondHighestValChallenges, thirdHighestValChallenges]


    //calls API for number 1, 2 and 3
    ///------------------------------------------------------------------------------------
    //checks best challenges

    let comparisonValue = []
    let tagScore = 0
    console.log(challengesExample[0].tags)
    for (let i = 0; i < challengesExample.length; i++) {
        let currentChallenge = challengesExample[i]
        for (let j = 0; j < currentChallenge.tags.length; j++) {
            let currentTag = challengesExample[i].tags[j]
            for (userTag of surveyResults.ChallengePreferences) {
                if (userTag == currentTag) {
                    tagScore++;
                }
            }
        }
        comparisonValue.push(tagScore)
        tagScore = 0
    }

    console.log('comparisonValue', comparisonValue)
    for (let i = 0; i < comparisonValue.length; i++) {
        challengesExample[i].surveyScore = comparisonValue[i]
    }

    challengesExample.sort(function (a, b) { return a.surveyScore - b.surveyScore; }).reverse()

    console.log(challengesExample)
    //organize array from big to low
  

    //show info in the side bar
/*     showChallengeInfo(challengesExample[0])
    showChallengeInfo(challengesExample[1])
 */
        challengeLocationMarkers(challengesExample[0], bestPlaces, 1)

    setTimeout(() => {
        challengeLocationMarkers(challengesExample[1], bestPlaces, 1)
    },3000);
    /*      setTimeout(() => {
            console.log(challengesExample[comparisonValue[2]]) ///this gets the challenges
            challengeLocationMarkers(challengesExample[comparisonValue[2]], bestPlaces, 1)
        }, 12000);  */
    
        setTimeout(() => {
        librarians.aroundVancouverMarkers('park', 3)
    },2000);
}

/*  */

const challengeLocationMarkers = (challenge, bestPlaces, delay) => {
    let animationDelay = delay * 1000

    showChallengeInfo(challenge)

    librarians.challengeMarker(challenge)

    //check if there are coordinates
    for (let i = 0; i < bestPlaces.length; i++) {
        setTimeout(() => {
            librarians.placesAPIRequest(bestPlaces[i].name, challenge.areaCoordinates, 3, false, 1200)
        }, animationDelay * i);
    } 
}

const showChallengeInfo = (challenge) => {
    let challengeContainer = document.getElementById('challengeContainer');

    if (userPreferences.budget == 'low') {
        challengeContainer.innerHTML += `
        <div class="challengeInfo">
            <div class="titleChallenge">${challenge.name}</div>
                <div class="challengeDesc">${challenge.description}</div>
                <div class="challengeStepsContainer">
                    <li class="challengeSteps">${challenge.steps.low[0].desc}</li>
                    <li class="challengeSteps">${challenge.steps.low[1].desc}</li>
                    <li class="challengeSteps">${challenge.steps.low[2].desc}</li>
                </div>
            <div class="challengeButton" onclick="panToChallenge(${challenge.areaCoordinates.lat},${challenge.areaCoordinates.lng})">Explore</div>
        </div>

    `
        let placeMarker = {
            position: {lat:'',lng:''},
            title: '',
            name: '',
            icon: '',
            category: 'challengeStep',
            description: '',
            image: '',
        }
        for (let i = 0; i < challenge.steps.low.length; i++) {
            let challengeStep = challenge.steps.low[i]

            //checks if there are specific coordinates for the step
            if(challengeStep.coord==false){console.log('has no coordinates')}
            else{
                if(i==0){placeMarker.title = 'First Step!' ;placeMarker.icon = markerN1; }
                if(i==1){placeMarker.title = 'Second Step!';placeMarker.icon = markerN2; }
                if(i==2){placeMarker.title = 'Third Step!' ;placeMarker.icon = markerN3; }
                placeMarker.title = challenge.name
                placeMarker.name = challenge.name
                placeMarker.description = challengeStep.desc
                placeMarker.image = challengeStep.image
                placeMarker.position = {lat: challengeStep.coord.lat, lng: challengeStep.coord.lng}
                librarians.pinMaker(placeMarker)
            }

            //checks if there are specific TAGS for the step
            if(challengeStep.tag==false){console.log('has no tags')}
            else{
                if(i==0){placeMarker.title = 'First Step!' ;placeMarker.icon = orangeMarkerN1; }
                if(i==1){placeMarker.title = 'Second Step!';placeMarker.icon = orangeMarkerN2; }
                if(i==2){placeMarker.title = 'Third Step!' ;placeMarker.icon = orangeMarkerN3; }
                placeMarker.description = challengeStep.desc
                placeMarker.image = challengeStep.image
                let placeMarkerPosition = {lat: challengeStep.coord.lat, lng: challengeStep.coord.lng}
                setTimeout(() => {
              //  librarians.placesAPIRequest(challengeStep.tag[0], placeMarkerPosition, 3, false,  1200) //(type, position, npins, remove, radius)
            }, i * 6000);
            }
        }
    }

    if (userPreferences.budget == 'high') {
        challengeContainer.innerHTML += `
        <div class="challengeInfo">
            <div class="titleChallenge">${challenge.name}</div>
                <div class="challengeDesc">${challenge.description}</div>
                <div class="challengeStepsContainer">
                    <li class="challengeSteps">${challenge.steps.high[0].desc}</li>
                    <li class="challengeSteps">${challenge.steps.high[1].desc}</li>
                    <li class="challengeSteps">${challenge.steps.high[2].desc}</li>
                </div>
            <div class="challengeButton">Explore</div>
        </div>

    `
    let placeMarker = {
        position: {lat:'',lng:''},
        title: '',
        icon: '',
        category: 'challengeStep'
    }
    for (let i = 0; i < challenge.steps.high.length; i++) {
        let challengeStep = challenge.steps.low[i]
        if(challengeStep.coord==false){return console.log('has no coordinates')}
        else{
            if(i==0){placeMarker.title = 'First Step!' ;placeMarker.icon = markerN1}
            if(i==1){placeMarker.title = 'Second Step!';placeMarker.icon = markerN2}
            if(i==2){placeMarker.title = 'Third Step!' ;placeMarker.icon = markerN3}
            placeMarker.position = {lat: challengeStep.coord.lat, lng: challengeStep.coord.lng}
            librarians.pinMaker(placeMarker)
        }
    }
}
}

const panToChallenge = (lat,lng) => {
    console.log(lat,lng)
    let challengePos = {lat:lat, lng:lng}
    map.panTo(challengePos)
    map.setZoom(14)
}



//show route info
    //set up new page
//aroundvan markers update
    //setup new callback

//fix user flow
    //just resets storage

//main page login button be custom


//mobile style
